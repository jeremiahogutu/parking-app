<h2>Current time <span id="time" class="data-fix"></span></h2>
<h2>Ticket purchased at: <span class="data-fix"><%= (Parking.last.created_at - 4.hours).strftime('%r') %></span></h2>
<h2> Ticket valid until: <span class="data-fix"><%= ((Parking.last.created_at - 4.hours) + Parking.last.validity.hours).strftime("%r") %></span></h2>
<!--<h3><%#= Parking.first.validity - TimeDifference.between(Time.now, Parking.first.created_at).in_hours  %></h3>-->
<h2>Time Left: <span id="demo" class="data-fix"></span></h2>
<h2> Parking spots available <span class="data-fix"><%= @spots_available %></span></h2>

<script>
    // Set the date we're counting down to
    console.log('Ticket valid until <%= ((Parking.last.created_at - 4.hours) + Parking.last.validity.hours).strftime("%b %d, %Y %H:%M:%S") %>');
    var countDownDate = new Date("<%= ((Parking.last.created_at - 4.hours) + Parking.last.validity.hours).strftime("%b %d, %Y %H:%M:%S") %>").getTime();

    // Update the count down every 1 second
    var x = setInterval(function() {

        // Get todays date and time
        var now = new Date().getTime();

        // Find the distance between now and the count down date
        var distance = countDownDate - now;

        // Time calculations for days, hours, minutes and seconds
        var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        var seconds = Math.floor((distance % (1000 * 60)) / 1000);

        // Display the result in the element with id="demo"
        document.getElementById("demo").innerHTML = hours + "h "
            + minutes + "m " + seconds + "s ";

        // If the count down is finished, write some text
        if (distance < 0) {
            clearInterval(x);
            document.getElementById("demo").innerHTML = "EXPIRED";
        }
    }, 1000);

    function checkTime(i) {
        if (i < 10) {
            i = "0" + i;
        }
        return i;
    }

    function startTime() {
        var today = new Date();
        var h = today.getHours();
        var m = today.getMinutes();
        var s = today.getSeconds();
        var am_pm = 'am';
        if (h >= 12) {
            am_pm = 'pm';
            h = h - 12;
        }
        // add a zero in front of numbers<10
        m = checkTime(m);
        s = checkTime(s);
        document.getElementById('time').innerHTML = h + ":" + m + ":" + s + ' '+am_pm;
        t = setTimeout(function() {
            startTime()
        }, 500);
    }
    startTime();
</script>